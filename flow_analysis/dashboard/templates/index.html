<!DOCTYPE html>
<html>
<head>
    <title>Collector Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .status-card {
            margin-bottom: 20px;
        }
        .status-running { background-color: #d4edda; }
        .status-delayed { background-color: #fff3cd; }
        .status-stalled { background-color: #f8d7da; }
        .status-error { background-color: #f8d7da; }
        .status-no-data { background-color: #e2e3e5; }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="#">Collector Dashboard</a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="{{ url_for('logout') }}">Logout</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <div class="col-md-12 mb-4">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">System Health</h5>
                        <p class="card-text">
                            Overall Status: 
                            <span class="badge {% if health.overall_status == 'healthy' %}bg-success{% else %}bg-danger{% endif %}">
                                {{ health.overall_status }}
                            </span>
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            {% for collector_type, status in health.collectors.items() %}
            <div class="col-md-6">
                <div class="card status-card status-{{ status.status }}">
                    <div class="card-body">
                        <h5 class="card-title">{{ collector_type.title() }} Collector</h5>
                        <p class="card-text">
                            Status: 
                            <span class="badge {% if status.status == 'running' %}bg-success
                                             {% elif status.status == 'delayed' %}bg-warning
                                             {% else %}bg-danger{% endif %}">
                                {{ status.status }}
                            </span>
                        </p>
                        <p class="card-text">
                            Last Update: {{ status.last_update }}
                        </p>
                        <p class="card-text">
                            <small class="text-muted">{{ status.message }}</small>
                        </p>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <div class="row mt-4">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Status History</h5>
                        <canvas id="statusChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Fetch and update status every 30 seconds
        function updateStatus() {
            fetch('/api/status')
                .then(response => response.json())
                .then(data => {
                    // Update status cards
                    Object.entries(data.collectors).forEach(([collector, status]) => {
                        const card = document.querySelector(`[data-collector="${collector}"]`);
                        if (card) {
                            card.className = `card status-card status-${status.status}`;
                            card.querySelector('.status-badge').textContent = status.status;
                            card.querySelector('.last-update').textContent = status.last_update;
                            card.querySelector('.status-message').textContent = status.message;
                        }
                    });
                });
        }

        // Fetch and update history chart
        function updateHistory() {
            fetch('/api/history')
                .then(response => response.json())
                .then(data => {
                    // Update chart with historical data
                    // This is a placeholder - implement actual chart update logic
                });
        }

        // Initial load
        updateStatus();
        updateHistory();

        // Set up periodic updates
        setInterval(updateStatus, 30000);
        setInterval(updateHistory, 300000);  // Update history every 5 minutes
    </script>
</body>
</html> 